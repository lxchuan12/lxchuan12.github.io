<!DOCTYPE html>
<html>
<head>
    

    

    



    <meta charset="utf-8">
    
    
    
    
    <title>分析vue-cli@2.9.3 搭建的webpack项目工程 | 轩辕Rowboat的博客 | 前端路上 | PPT爱好者 | 所知甚少，唯善学。常以轩辕Rowboat为名混迹于江湖。</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    
    <meta name="keywords" content="vue,vue-cli,webpack">
    <meta name="description" content="前言 已经有很多分析Vue-cli搭建工程的文章，为什么自己还要写一遍呢。学习就好比是座大山，人们沿着不同的路登山，分享着自己看到的风景。你不一定能看到别人看到的风景，体会到别人的心情。只有自己去登山，才能看到不一样的风景，体会才更加深刻。  项目放在笔者的github上，分析vue-cli@2.9.3 搭建的webpack项目工程。方便大家克隆下载，或者在线查看。同时也求个star ^_^，也是">
<meta name="keywords" content="vue,vue-cli,webpack">
<meta property="og:type" content="article">
<meta property="og:title" content="分析vue-cli@2.9.3 搭建的webpack项目工程">
<meta property="og:url" content="https://lxchuan12.github.io/2018/06/11/20180611-analyse-vue-cli/index.html">
<meta property="og:site_name" content="轩辕Rowboat的博客">
<meta property="og:description" content="前言 已经有很多分析Vue-cli搭建工程的文章，为什么自己还要写一遍呢。学习就好比是座大山，人们沿着不同的路登山，分享着自己看到的风景。你不一定能看到别人看到的风景，体会到别人的心情。只有自己去登山，才能看到不一样的风景，体会才更加深刻。  项目放在笔者的github上，分析vue-cli@2.9.3 搭建的webpack项目工程。方便大家克隆下载，或者在线查看。同时也求个star ^_^，也是">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2018-06-12T14:29:33.460Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="分析vue-cli@2.9.3 搭建的webpack项目工程">
<meta name="twitter:description" content="前言 已经有很多分析Vue-cli搭建工程的文章，为什么自己还要写一遍呢。学习就好比是座大山，人们沿着不同的路登山，分享着自己看到的风景。你不一定能看到别人看到的风景，体会到别人的心情。只有自己去登山，才能看到不一样的风景，体会才更加深刻。  项目放在笔者的github上，分析vue-cli@2.9.3 搭建的webpack项目工程。方便大家克隆下载，或者在线查看。同时也求个star ^_^，也是">
    
        <link rel="alternate" type="application/atom+xml" title="轩辕Rowboat的博客" href="/atom.xml">
    
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="stylesheet" href="/css/style.css?v=1.7.2">
    <script src="//cdnjs.cloudflare.com/ajax/libs/platform/1.3.5/platform.min.js"></script>
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/img/brand.jpg)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/logo.jpg">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">轩辕Rowboat</h5>
          <a href="mailto:lxchuan12@163.com" title="lxchuan12@163.com" class="mail">lxchuan12@163.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="menu-tsa waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                主页
              </a>
            </li>
        
            <li class="menu-tsa waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                文章
              </a>
            </li>
        
            <li class="menu-tsa waves-block waves-effect">
              <a href="http://www.jianshu.com/users/83129d433d72/latest_articles" target="_blank" >
                <i class="icon icon-lg icon-book"></i>
                简书
              </a>
            </li>
        
            <li class="menu-tsa waves-block waves-effect">
              <a href="http://weibo.com/lxchuan12" target="_blank" >
                <i class="icon icon-lg icon-weibo"></i>
                微博
              </a>
            </li>
        
            <li class="menu-tsa waves-block waves-effect">
              <a href="https://segmentfault.com/u/lxchuan12/" target="_blank" >
                <i class="icon icon-lg icon-hand-o-right"></i>
                Segmentfault
              </a>
            </li>
        
            <li class="menu-tsa waves-block waves-effect">
              <a href="https://github.com/lxchuan12" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="menu-tsa waves-block waves-effect">
              <a href="https://www.zhihu.com/people/lxchuan12/activities" target="_blank" >
                <i class="icon icon-lg icon-stream"></i>
                知乎
              </a>
            </li>
        
            <li class="menu-tsa waves-block waves-effect">
              <a href="https://lxchuan12.github.io/2016/11/20/20161120-about%20me/"  >
                <i class="icon icon-lg icon-user"></i>
                关于我
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">分析vue-cli@2.9.3 搭建的webpack项目工程</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="输入感兴趣的关键字">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">分析vue-cli@2.9.3 搭建的webpack项目工程</h1>
        <h5 class="subtitle">
            
                <time datetime="2018-06-11T12:22:38.000Z" itemprop="datePublished" class="page-time">
  2018-06-11
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/vue/">vue</a></li></ul>

            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap post-toc-shrink" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#前言"><span class="post-toc-number">1.</span> <span class="post-toc-text">前言</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#使用vue-cli初始化webpack工程"><span class="post-toc-number">2.</span> <span class="post-toc-text">使用vue-cli初始化webpack工程</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#package-json"><span class="post-toc-number">3.</span> <span class="post-toc-text">package.json</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#build-webpack-dev-conf-js-webpack开发环境配置"><span class="post-toc-number">4.</span> <span class="post-toc-text">build/webpack.dev.conf.js webpack开发环境配置</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#build-utils-js-工具函数"><span class="post-toc-number">5.</span> <span class="post-toc-text">build/utils.js 工具函数</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#build-webpack-base-conf-js-webpack基本配置文件"><span class="post-toc-number">6.</span> <span class="post-toc-text">build/webpack.base.conf.js webpack基本配置文件</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#build-vue-loader-conf-js-vue-loader配置文件"><span class="post-toc-number">7.</span> <span class="post-toc-text">build/vue-loader.conf.js vue-loader配置文件</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#build-build-js-npm-run-build-指定执行的文件"><span class="post-toc-number">8.</span> <span class="post-toc-text">build/build.js npm run build 指定执行的文件</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#build-check-versions-检查node和npm版本"><span class="post-toc-number">9.</span> <span class="post-toc-text">build/check-versions 检查node和npm版本</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#build-webpack-prod-conf-js-webpack生产环境配置"><span class="post-toc-number">10.</span> <span class="post-toc-text">build/webpack.prod.conf.js webpack生产环境配置</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#babelrc-babel相关配置"><span class="post-toc-number">11.</span> <span class="post-toc-text">.babelrc babel相关配置</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#关于"><span class="post-toc-number">12.</span> <span class="post-toc-text">关于</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#小结"><span class="post-toc-number">13.</span> <span class="post-toc-text">小结</span></a></li></ol>
        </nav>
    </aside>


<article id="post-20180611-analyse-vue-cli"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">分析vue-cli@2.9.3 搭建的webpack项目工程</h1>
        <div class="post-meta">
            <time class="post-time" title="2018-06-11 20:22:38" datetime="2018-06-11T12:22:38.000Z"  itemprop="datePublished">2018-06-11</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/vue/">vue</a></li></ul>



            
<span id="busuanzi_container_page_pv" title="文章总阅读量" style='display:none'>
    <i class="icon icon-eye icon-pr"></i><span id="busuanzi_value_page_pv"></span>
</span>


        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><blockquote>
<p>已经有很多分析<code>Vue-cli</code>搭建工程的文章，为什么自己还要写一遍呢。学习就好比是座大山，人们沿着不同的路登山，分享着自己看到的风景。你不一定能看到别人看到的风景，体会到别人的心情。只有自己去登山，才能看到不一样的风景，体会才更加深刻。</p>
</blockquote>
<p><strong>项目放在笔者的<code>github</code>上，<a href="https://github.com/lxchuan12/analyse-vue-cli" target="_blank" rel="noopener">分析vue-cli@2.9.3 搭建的webpack项目工程</a>。方便大家克隆下载，或者在线查看。同时也求个<code>star</code> <code>^_^</code>，也是对笔者的一种鼓励和支持。</strong></p>
<p>正文从这里开始～</p>
<h3 id="使用vue-cli初始化webpack工程"><a href="#使用vue-cli初始化webpack工程" class="headerlink" title="使用vue-cli初始化webpack工程"></a>使用<code>vue-cli</code>初始化<code>webpack</code>工程</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">// # 安装</span><br><span class="line">npm install -g vue-cli</span><br><span class="line">// 安装完后vue命令就可以使用了。实际上是全局注册了vue、vue-init、vue-list几个命令</span><br><span class="line"></span><br><span class="line">// # ubuntu 系统下</span><br><span class="line">// [vue-cli@2.9.3] link /usr/local/bin/vue@ -&gt; /usr/local/lib/node_modules/vue-cli/bin/vue</span><br><span class="line">// [vue-cli@2.9.3] link /usr/local/bin/vue-init@ -&gt; /usr/local/lib/node_modules/vue-cli/bin/vue-init</span><br><span class="line">// [vue-cli@2.9.3] link /usr/local/bin/vue-list@ -&gt; /usr/local/lib/node_modules/vue-cli/bin/vue-list</span><br><span class="line"></span><br><span class="line">vue list</span><br><span class="line">// 可以发现有browserify、browserify-simple、pwa、simple、webpack、webpack-simple几种模板可选，这里选用webpack。</span><br><span class="line"></span><br><span class="line">// # 使用 vue init</span><br><span class="line">vue init &lt;template-name&gt; &lt;project-name&gt;</span><br><span class="line"></span><br><span class="line">// # 例子</span><br><span class="line">vue init webpack analyse-vue-cli</span><br></pre></td></tr></table></figure>
<p>更多<code>vue-cli</code>如何工作的可以查看这篇文章<a href="https://juejin.im/post/5a7b1b86f265da4e8f049081" target="_blank" rel="noopener">vue-cli是如何工作的</a>，或者分析Vue-cli源码查看这篇<a href="https://segmentfault.com/a/1190000013975247" target="_blank" rel="noopener">走进Vue-cli源码，自己动手搭建前端脚手架工具</a>，再或者直接查看<a href="https://github.com/vuejs/vue-cli/tree/master" target="_blank" rel="noopener">vue-cli github仓库源码</a></p>
<p>如果对<code>webpack</code>还不是很了解，可以查看<a href="https://webpack.docschina.org/concepts/" target="_blank" rel="noopener">webpack官方文档中的概念</a>，虽然是最新版本的，但概念都是差不多的。</p>
<h3 id="package-json"><a href="#package-json" class="headerlink" title="package.json"></a><code>package.json</code></h3><p>分析一个项目，一般从<code>package.json</code>的命令入口<code>scripts</code>开始。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&quot;scripts&quot;: &#123;</span><br><span class="line">  // dev webpack-dev-server --inline 模式 --progress 显示进度 --config 指定配置文件（默认是webpack.config.js）</span><br><span class="line">  &quot;dev&quot;: &quot;webpack-dev-server --inline --progress --config build/webpack.dev.conf.js&quot;,</span><br><span class="line">  &quot;start&quot;: &quot;npm run dev&quot;,</span><br><span class="line">  // jest测试</span><br><span class="line">  &quot;unit&quot;: &quot;jest --config test/unit/jest.conf.js --coverage&quot;,</span><br><span class="line">  // e2e测试</span><br><span class="line">  &quot;e2e&quot;: &quot;node test/e2e/runner.js&quot;,</span><br><span class="line">  // 运行jest测试和e2e测试</span><br><span class="line">  &quot;test&quot;: &quot;npm run unit &amp;&amp; npm run e2e&quot;,</span><br><span class="line">  // eslint --ext 指定扩展名和相应的文件</span><br><span class="line">  &quot;lint&quot;: &quot;eslint --ext .js,.vue src test/unit test/e2e/specs&quot;,</span><br><span class="line">  // node 执行build/build.js文件</span><br><span class="line">  &quot;build&quot;: &quot;node build/build.js&quot;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></p>
<p><code>Npm Script</code> 底层实现原理是通过调用 <code>Shell</code> 去运行脚本命令。<code>npm run start</code>等同于运行<code>npm run dev</code>。</p>
<p><code>Npm Script</code> 还有一个重要的功能是能运行安装到项目目录里的 <code>node_modules</code> 里的可执行模块。</p>
<p>例如在通过命令<code>npm i -D webpack-dev-server</code>将<code>webpack-dev-server</code>安装到项目后，是无法直接在项目根目录下通过命令 <code>webpack-dev-server</code> 去执行 <code>webpack-dev-server</code> 构建的，而是要通过命令 <code>./node_modules/.bin/webpack-dev-server</code> 去执行。</p>
<p><code>Npm Script</code> 能方便的解决这个问题，只需要在 <code>scripts</code> 字段里定义一个任务，例如：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;dev&quot;: &quot;webpack-dev-server --inline --progress --config build/webpack.dev.conf.js&quot;</span><br></pre></td></tr></table></figure></p>
<p><code>Npm Script</code> 会先去项目目录下的 <code>node_modules</code> 中寻找有没有可执行的 <code>webpack-dev-server</code> 文件，如果有就使用本地的，如果没有就使用全局的。 所以现在执行 <code>webpack-dev-server</code> 启动服务时只需要通过执行 <code>npm run dev</code> 去实现。</p>
<blockquote>
<p>再来看下 npm run dev<br> <code>webpack-dev-server</code> 其实是一个<code>node.js</code>的应用程序，它是通过<code>JavaScript</code>开发的。在命令行执行<code>npm run dev</code>命令等同于执行<code>node ./node_modules/webpack-dev-server/bin/webpack-dev-server.js --inline --progress --config build/webpack.dev.conf.js</code>。你可以试试。</p>
</blockquote>
<p>更多<code>package.json</code>的配置项，可以查看<a href="http://javascript.ruanyifeng.com/nodejs/packagejson.html" target="_blank" rel="noopener">阮一峰老师的文章 package.json文件</a></p>
<p><code>npm run dev</code>指定了<code>build/webpack.dev.conf.js</code>配置去启动服务，那么我们来看下这个文件做了什么。</p>
<h3 id="build-webpack-dev-conf-js-webpack开发环境配置"><a href="#build-webpack-dev-conf-js-webpack开发环境配置" class="headerlink" title="build/webpack.dev.conf.js webpack开发环境配置"></a><code>build/webpack.dev.conf.js</code> <code>webpack</code>开发环境配置</h3><p>这个文件主要做了以下几件事情：<br>1、引入各种依赖，同时也引入了<code>config</code>文件夹下的变量和配置，和一个工具函数<code>build/utils.js</code>，<br>2、合并<code>build/webpack.base.conf.js</code>配置文件，<br>3、配置开发环境一些<code>devServer</code>，<code>plugin</code>等配置，<br>4、最后导出了一个<code>Promise</code>，根据配置的端口，寻找可用的端口来启动服务。</p>
<p>具体可以看<code>build/webpack.dev.conf.js</code>这个文件注释：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br></pre></td><td class="code"><pre><span class="line">&apos;use strict&apos;</span><br><span class="line">// 引入工具函数</span><br><span class="line">const utils = require(&apos;./utils&apos;)</span><br><span class="line">// 引入webpack</span><br><span class="line">const webpack = require(&apos;webpack&apos;)</span><br><span class="line">// 引入config/index.js配置</span><br><span class="line">const config = require(&apos;../config&apos;)</span><br><span class="line">// 合并webpack配置</span><br><span class="line">const merge = require(&apos;webpack-merge&apos;)</span><br><span class="line">const path = require(&apos;path&apos;)</span><br><span class="line">// 基本配置</span><br><span class="line">const baseWebpackConfig = require(&apos;./webpack.base.conf&apos;)</span><br><span class="line">// 拷贝插件</span><br><span class="line">const CopyWebpackPlugin = require(&apos;copy-webpack-plugin&apos;)</span><br><span class="line">// 生成html的插件</span><br><span class="line">const HtmlWebpackPlugin = require(&apos;html-webpack-plugin&apos;)</span><br><span class="line">// 友好提示的插件 https://github.com/geowarin/friendly-errors-webpack-plugin</span><br><span class="line">const FriendlyErrorsPlugin = require(&apos;friendly-errors-webpack-plugin&apos;)</span><br><span class="line">// 查找可用端口 // github仓库 https://github.com/indexzero/node-portfinder</span><br><span class="line">const portfinder = require(&apos;portfinder&apos;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// process模块用来与当前进程互动，可以通过全局变量process访问，不必使用require命令加载。它是一个EventEmitter对象的实例。</span><br><span class="line"></span><br><span class="line">// 后面有些process模块用到的，所以这里统一列举下。</span><br><span class="line">// 更多查看这篇阮一峰的这篇文章 http://javascript.ruanyifeng.com/nodejs/process.html</span><br><span class="line"></span><br><span class="line">// process对象提供一系列属性，用于返回系统信息。</span><br><span class="line">// process.pid：当前进程的进程号。</span><br><span class="line">// process.version：Node的版本，比如v0.10.18。</span><br><span class="line">// process.platform：当前系统平台，比如Linux。</span><br><span class="line">// process.title：默认值为“node”，可以自定义该值。</span><br><span class="line">// process.argv：当前进程的命令行参数数组。</span><br><span class="line">// process.env：指向当前shell的环境变量，比如process.env.HOME。</span><br><span class="line">// process.execPath：运行当前进程的可执行文件的绝对路径。</span><br><span class="line">// process.stdout：指向标准输出。</span><br><span class="line">// process.stdin：指向标准输入。</span><br><span class="line">// process.stderr：指向标准错误。</span><br><span class="line"></span><br><span class="line">// process对象提供以下方法：</span><br><span class="line">// process.exit()：退出当前进程。</span><br><span class="line">// process.cwd()：返回运行当前脚本的工作目录的路径。_</span><br><span class="line">// process.chdir()：改变工作目录。</span><br><span class="line">// process.nextTick()：将一个回调函数放在下次事件循环的顶部。</span><br><span class="line"></span><br><span class="line">// host</span><br><span class="line">const HOST = process.env.HOST</span><br><span class="line">// 端口</span><br><span class="line">const PORT = process.env.PORT &amp;&amp; Number(process.env.PORT)</span><br><span class="line"></span><br><span class="line">// 合并基本的webpack配置</span><br><span class="line">const devWebpackConfig = merge(baseWebpackConfig, &#123;</span><br><span class="line">  module: &#123;</span><br><span class="line">    // cssSourceMap这里配置的是true</span><br><span class="line">    rules: utils.styleLoaders(&#123; sourceMap: config.dev.cssSourceMap, usePostCSS: true &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  // cheap-module-eval-source-map is faster for development</span><br><span class="line">  // 在开发环境是cheap-module-eval-source-map选项更快</span><br><span class="line">  // 这里配置的是cheap-module-eval-source-map</span><br><span class="line">  // 更多可以查看中文文档：https://webpack.docschina.org/configuration/devtool/#devtool</span><br><span class="line">  // 英文 https://webpack.js.org/configuration/devtool/#development</span><br><span class="line">  devtool: config.dev.devtool,</span><br><span class="line"></span><br><span class="line">  // these devServer options should be customized in /config/index.js</span><br><span class="line">  devServer: &#123;</span><br><span class="line">    // 配置在客户端的日志等级，这会影响到你在浏览器开发者工具控制台里看到的日志内容。</span><br><span class="line">    // clientLogLevel 是枚举类型，可取如下之一的值 none | error | warning | info。</span><br><span class="line">    // 默认为 info 级别，即输出所有类型的日志，设置成 none 可以不输出任何日志。</span><br><span class="line">    clientLogLevel: &apos;warning&apos;,</span><br><span class="line">    // historyApiFallback boolean object 用于方便的开发使用了 HTML5 History API 的单页应用。</span><br><span class="line">    // 可以简单true 或者 任意的 404 响应可以提供为 index.html 页面。</span><br><span class="line">    historyApiFallback: &#123;</span><br><span class="line">      rewrites: [</span><br><span class="line">        // config.dev.assetsPublicPath 这里是 /</span><br><span class="line">        &#123; from: /.*/, to: path.posix.join(config.dev.assetsPublicPath, &apos;index.html&apos;) &#125;,</span><br><span class="line">      ],</span><br><span class="line">    &#125;,</span><br><span class="line">    // 开启热更新</span><br><span class="line">    hot: true,</span><br><span class="line">    // contentBase 配置 DevServer HTTP 服务器的文件根目录。</span><br><span class="line">    // 默认情况下为当前执行目录，通常是项目根目录，所有一般情况下你不必设置它，除非你有额外的文件需要被 DevServer 服务。</span><br><span class="line">    contentBase: false, // since we use CopyWebpackPlugin.</span><br><span class="line">    // compress 配置是否启用 gzip 压缩。boolean 为类型，默认为 false。</span><br><span class="line">    compress: true,</span><br><span class="line">    // host</span><br><span class="line">    // 例如你想要局域网中的其它设备访问你本地的服务，可以在启动 DevServer 时带上 --host 0.0.0.0</span><br><span class="line">    // 或者直接设置为 0.0.0.0</span><br><span class="line">    // 这里配置的是localhost</span><br><span class="line">    host: HOST || config.dev.host,</span><br><span class="line">    // 端口号 这里配置的是8080</span><br><span class="line">    port: PORT || config.dev.port,</span><br><span class="line">    // 打开浏览器，这里配置是不打开false</span><br><span class="line">    open: config.dev.autoOpenBrowser,</span><br><span class="line">    // 是否在浏览器以遮罩形式显示报错信息 这里配置的是true</span><br><span class="line">    overlay: config.dev.errorOverlay</span><br><span class="line">      ? &#123; warnings: false, errors: true &#125;</span><br><span class="line">      : false,</span><br><span class="line">      // 这里配置的是 /</span><br><span class="line">    publicPath: config.dev.assetsPublicPath,</span><br><span class="line">    // 代理 这里配置的是空&#123;&#125;,有需要可以自行配置</span><br><span class="line">    proxy: config.dev.proxyTable,</span><br><span class="line">    // 启用 quiet 后，除了初始启动信息之外的任何内容都不会被打印到控制台。这也意味着来自 webpack 的错误或警告在控制台不可见。</span><br><span class="line">    // 开启后一般非常干净只有类似的提示 Your application is running here: http://localhost:8080</span><br><span class="line">    quiet: true, // necessary for FriendlyErrorsPlugin</span><br><span class="line">    // webpack-dev-middleware</span><br><span class="line">    // watch: false,</span><br><span class="line">    // 启用 Watch 模式。这意味着在初始构建之后，webpack 将继续监听任何已解析文件的更改。Watch 模式默认关闭。</span><br><span class="line">    // webpack-dev-server 和 webpack-dev-middleware 里 Watch 模式默认开启。</span><br><span class="line">    // Watch 模式的选项</span><br><span class="line">    watchOptions: &#123;</span><br><span class="line">      // 或者指定毫秒为单位进行轮询。</span><br><span class="line">      // 这里配置为false</span><br><span class="line">      poll: config.dev.poll,</span><br><span class="line">    &#125;</span><br><span class="line">    // 更多查看中文文档：https://webpack.docschina.org/configuration/watch/#src/components/Sidebar/Sidebar.jsx</span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [</span><br><span class="line">    // 定义为开发环境</span><br><span class="line">    new webpack.DefinePlugin(&#123;</span><br><span class="line">      // 这里是 &#123; NODE_ENV: &apos;&quot;development&quot;&apos; &#125;</span><br><span class="line">      &apos;process.env&apos;: require(&apos;../config/dev.env&apos;)</span><br><span class="line">    &#125;),</span><br><span class="line">    // 热更新插件</span><br><span class="line">    new webpack.HotModuleReplacementPlugin(),</span><br><span class="line">    // 热更新时显示具体的模块路径</span><br><span class="line">    new webpack.NamedModulesPlugin(), // HMR shows correct file names in console on update.</span><br><span class="line">    // 在编译出现错误时，使用 NoEmitOnErrorsPlugin 来跳过输出阶段。</span><br><span class="line">    new webpack.NoEmitOnErrorsPlugin(),</span><br><span class="line">    // github仓库 https://github.com/ampedandwired/html-webpack-plugin</span><br><span class="line">    new HtmlWebpackPlugin(&#123;</span><br><span class="line">      filename: &apos;index.html&apos;,</span><br><span class="line">      template: &apos;index.html&apos;,</span><br><span class="line">      // inject 默认值 true，script标签位于html文件的 body 底部</span><br><span class="line">      // body 通true, header, script 标签位于 head 标签内</span><br><span class="line">      // false 不插入生成的 js 文件，只是单纯的生成一个 html 文件</span><br><span class="line">      inject: true</span><br><span class="line">    &#125;),</span><br><span class="line">    // copy custom static assets</span><br><span class="line">    // 把static资源复制到相应目录。</span><br><span class="line">    new CopyWebpackPlugin([</span><br><span class="line">      &#123;</span><br><span class="line">        // 这里是 static</span><br><span class="line">        from: path.resolve(__dirname, &apos;../static&apos;),</span><br><span class="line">        // 这里是 static</span><br><span class="line">        to: config.dev.assetsSubDirectory,</span><br><span class="line">        // 忽略.开头的文件。比如这里的.gitkeep，这个文件是指空文件夹也提交到git</span><br><span class="line">        ignore: [&apos;.*&apos;]</span><br><span class="line">      &#125;</span><br><span class="line">    ])</span><br><span class="line">  ]</span><br><span class="line">&#125;)</span><br><span class="line">// 导出一个promise</span><br><span class="line">module.exports = new Promise((resolve, reject) =&gt; &#123;</span><br><span class="line">  // process.env.PORT 可以在命令行指定端口号，比如PORT=2000 npm run dev，那访问就是http://localhost:2000</span><br><span class="line">  // config.dev.port 这里配置是 8080</span><br><span class="line">  portfinder.basePort = process.env.PORT || config.dev.port</span><br><span class="line">  // 以配置的端口为基准，寻找可用的端口，比如：如果8080占用，那就8081,以此类推</span><br><span class="line">  // github仓库 https://github.com/indexzero/node-portfinder</span><br><span class="line">  portfinder.getPort((err, port) =&gt; &#123;</span><br><span class="line">    if (err) &#123;</span><br><span class="line">      reject(err)</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      // publish the new Port, necessary for e2e tests</span><br><span class="line">      process.env.PORT = port</span><br><span class="line">      // add port to devServer config</span><br><span class="line">      devWebpackConfig.devServer.port = port</span><br><span class="line"></span><br><span class="line">      // Add FriendlyErrorsPlugin</span><br><span class="line">      devWebpackConfig.plugins.push(new FriendlyErrorsPlugin(&#123;</span><br><span class="line">        compilationSuccessInfo: &#123;</span><br><span class="line">          messages: [`Your application is running here: http://$&#123;devWebpackConfig.devServer.host&#125;:$&#123;port&#125;`],</span><br><span class="line">        &#125;,</span><br><span class="line">        // notifyOnErrors 这里配置是 true</span><br><span class="line">        // onErrors 是一个函数，出错输出错误信息，系统原生的通知</span><br><span class="line">        onErrors: config.dev.notifyOnErrors</span><br><span class="line">        ? utils.createNotifierCallback()</span><br><span class="line">        : undefined</span><br><span class="line">      &#125;))</span><br><span class="line"></span><br><span class="line">      resolve(devWebpackConfig)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="build-utils-js-工具函数"><a href="#build-utils-js-工具函数" class="headerlink" title="build/utils.js 工具函数"></a><code>build/utils.js</code> 工具函数</h3><p>上文<code>build/webpack.dev.conf.js</code>提到引入了<code>build/utils.js</code>工具函数。<br>该文件主要写了以下几个工具函数：<br>1、<code>assetsPath</code>返回输出路径，<br>2、<code>cssLoaders</code>返回相应的<code>css-loader</code>配置，<br>3、<code>styleLoaders</code>返回相应的处理样式的配置，<br>4、<code>createNotifierCallback</code>创建启动服务时出错时提示信息回调。</p>
<p>具体配置可以看该文件注释：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br></pre></td><td class="code"><pre><span class="line">&apos;use strict&apos;</span><br><span class="line">const path = require(&apos;path&apos;)</span><br><span class="line">// 引入配置文件config/index.js</span><br><span class="line">const config = require(&apos;../config&apos;)</span><br><span class="line">// 提取css的插件</span><br><span class="line">const ExtractTextPlugin = require(&apos;extract-text-webpack-plugin&apos;)</span><br><span class="line">// 引入package.json配置</span><br><span class="line">const packageConfig = require(&apos;../package.json&apos;)</span><br><span class="line">// 返回路径</span><br><span class="line">exports.assetsPath = function (_path) &#123;</span><br><span class="line">  const assetsSubDirectory = process.env.NODE_ENV === &apos;production&apos;</span><br><span class="line">    // 二级目录 这里是 static</span><br><span class="line">    ? config.build.assetsSubDirectory</span><br><span class="line">    // 二级目录 这里是 static</span><br><span class="line">    : config.dev.assetsSubDirectory</span><br><span class="line"></span><br><span class="line">  // 生成跨平台兼容的路径</span><br><span class="line">  // 更多查看Node API链接：https://nodejs.org/api/path.html#path_path_posix</span><br><span class="line">  return path.posix.join(assetsSubDirectory, _path)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">exports.cssLoaders = function (options) &#123;</span><br><span class="line">  // 作为参数传递进来的options对象</span><br><span class="line">  // &#123;</span><br><span class="line">  //   // sourceMap这里是true</span><br><span class="line">  //   sourceMap: true,</span><br><span class="line">  //   // 是否提取css到单独的css文件</span><br><span class="line">  //   extract: true,</span><br><span class="line">  //   // 是否使用postcss</span><br><span class="line">  //   usePostCSS: true</span><br><span class="line">  // &#125;</span><br><span class="line">  options = options || &#123;&#125;</span><br><span class="line"></span><br><span class="line">  const cssLoader = &#123;</span><br><span class="line">    loader: &apos;css-loader&apos;,</span><br><span class="line">    options: &#123;</span><br><span class="line">      sourceMap: options.sourceMap</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  const postcssLoader = &#123;</span><br><span class="line">    loader: &apos;postcss-loader&apos;,</span><br><span class="line">    options: &#123;</span><br><span class="line">      sourceMap: options.sourceMap</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  // generate loader string to be used with extract text plugin</span><br><span class="line">  // 创建对应的loader配置</span><br><span class="line">  function generateLoaders (loader, loaderOptions) &#123;</span><br><span class="line">    // 是否使用usePostCSS，来决定是否采用postcssLoader</span><br><span class="line">    const loaders = options.usePostCSS ? [cssLoader, postcssLoader] : [cssLoader]</span><br><span class="line"></span><br><span class="line">    if (loader) &#123;</span><br><span class="line">      loaders.push(&#123;</span><br><span class="line">        loader: loader + &apos;-loader&apos;,</span><br><span class="line">        // 合并 loaderOptions 生成options</span><br><span class="line">        options: Object.assign(&#123;&#125;, loaderOptions, &#123;</span><br><span class="line">          sourceMap: options.sourceMap</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // Extract CSS when that option is specified</span><br><span class="line">    // (which is the case during production build)</span><br><span class="line">    if (options.extract) &#123;</span><br><span class="line">      // 如果提取使用ExtractTextPlugin插件提取</span><br><span class="line">      // 更多配置 看插件中文文档：https://webpack.docschina.org/plugins/extract-text-webpack-plugin/</span><br><span class="line">      return ExtractTextPlugin.extract(&#123;</span><br><span class="line">        // 指需要什么样的loader去编译文件</span><br><span class="line">        // loader 被用于将资源转换成一个 CSS 导出模块 (必填)</span><br><span class="line">        use: loaders,</span><br><span class="line">        // loader（例如 &apos;style-loader&apos;）应用于当 CSS 没有被提取(也就是一个额外的 chunk，当 allChunks: false)</span><br><span class="line">        fallback: &apos;vue-style-loader&apos;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      return [&apos;vue-style-loader&apos;].concat(loaders)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  // https://vue-loader.vuejs.org/en/configurations/extract-css.html</span><br><span class="line">  return &#123;</span><br><span class="line">    css: generateLoaders(),</span><br><span class="line">    postcss: generateLoaders(),</span><br><span class="line">    less: generateLoaders(&apos;less&apos;),</span><br><span class="line">    // sass indentedSyntax 语法缩进，类似下方格式</span><br><span class="line">    // #main</span><br><span class="line">    //   color: blue</span><br><span class="line">    //   font-size: 0.3em</span><br><span class="line">    sass: generateLoaders(&apos;sass&apos;, &#123; indentedSyntax: true &#125;),</span><br><span class="line">    scss: generateLoaders(&apos;sass&apos;),</span><br><span class="line">    stylus: generateLoaders(&apos;stylus&apos;),</span><br><span class="line">    styl: generateLoaders(&apos;stylus&apos;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// Generate loaders for standalone style files (outside of .vue)</span><br><span class="line">// 最终会返回webpack css相关的配置</span><br><span class="line">exports.styleLoaders = function (options) &#123;</span><br><span class="line">  // &#123;</span><br><span class="line">  //   // sourceMap这里是true</span><br><span class="line">  //   sourceMap: true,</span><br><span class="line">  //   // 是否提取css到单独的css文件</span><br><span class="line">  //   extract: true,</span><br><span class="line">  //   // 是否使用postcss</span><br><span class="line">  //   usePostCSS: true</span><br><span class="line">  // &#125;</span><br><span class="line">  const output = []</span><br><span class="line">  const loaders = exports.cssLoaders(options)</span><br><span class="line"></span><br><span class="line">  for (const extension in loaders) &#123;</span><br><span class="line">    const loader = loaders[extension]</span><br><span class="line">    output.push(&#123;</span><br><span class="line">      test: new RegExp(&apos;\\.&apos; + extension + &apos;$&apos;),</span><br><span class="line">      use: loader</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  return output</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// npm run dev 出错时， FriendlyErrorsPlugin插件 配置 onErrors输出错误信息</span><br><span class="line">exports.createNotifierCallback = () =&gt; &#123;</span><br><span class="line">  // &apos;node-notifier&apos;是一个跨平台系统通知的页面，当遇到错误时，它能用系统原生的推送方式给你推送信息</span><br><span class="line">  const notifier = require(&apos;node-notifier&apos;)</span><br><span class="line"></span><br><span class="line">  return (severity, errors) =&gt; &#123;</span><br><span class="line">    if (severity !== &apos;error&apos;) return</span><br><span class="line"></span><br><span class="line">    const error = errors[0]</span><br><span class="line">    const filename = error.file &amp;&amp; error.file.split(&apos;!&apos;).pop()</span><br><span class="line"></span><br><span class="line">    notifier.notify(&#123;</span><br><span class="line">      title: packageConfig.name,</span><br><span class="line">      message: severity + &apos;: &apos; + error.name,</span><br><span class="line">      subtitle: filename || &apos;&apos;,</span><br><span class="line">      icon: path.join(__dirname, &apos;logo.png&apos;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="build-webpack-base-conf-js-webpack基本配置文件"><a href="#build-webpack-base-conf-js-webpack基本配置文件" class="headerlink" title="build/webpack.base.conf.js webpack基本配置文件"></a><code>build/webpack.base.conf.js</code> <code>webpack</code>基本配置文件</h3><p>上文<code>build/webpack.dev.conf.js</code>提到引入了<code>build/webpack.base.conf.js</code>这个<code>webpack</code>基本配置文件。<br>这个文件主要做了以下几件事情：<br>1、引入各种插件、配置等，其中引入了<code>build/vue-loader.conf.js</code>相关配置，<br>2、创建<code>eslint</code>规则配置，默认启用，<br>3、导出<code>webpack</code>配置对象，其中包含<code>context</code>，入口<code>entry</code>，输出<code>output</code>，<code>resolve</code>，<code>module</code>下的<code>rules</code>（处理对应文件的规则），和<code>node</code>相关的配置等。</p>
<p>具体可以看这个文件注释：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><span class="line">// 使用严格模式，更多严格模式可以查看</span><br><span class="line">// [阮一峰老师的es标准入门](http://es6.ruanyifeng.com/?search=%E4%B8%A5%E6%A0%BC%E6%A8%A1%E5%BC%8F&amp;x=0&amp;y=0#docs/function#%E4%B8%A5%E6%A0%BC%E6%A8%A1%E5%BC%8F)</span><br><span class="line">&apos;use strict&apos;</span><br><span class="line">const path = require(&apos;path&apos;)</span><br><span class="line">// 引入工具函数</span><br><span class="line">const utils = require(&apos;./utils&apos;)</span><br><span class="line">// 引入配置文件，也就是config/index.js文件</span><br><span class="line">const config = require(&apos;../config&apos;)</span><br><span class="line">// 引入vue-loader的配置文件</span><br><span class="line">const vueLoaderConfig = require(&apos;./vue-loader.conf&apos;)</span><br><span class="line">// 定义获取绝对路径函数</span><br><span class="line">function resolve (dir) &#123;</span><br><span class="line">  return path.join(__dirname, &apos;..&apos;, dir)</span><br><span class="line">&#125;</span><br><span class="line">// 创建eslint配置</span><br><span class="line">const createLintingRule = () =&gt; (&#123;</span><br><span class="line">  test: /\.(js|vue)$/,</span><br><span class="line">  loader: &apos;eslint-loader&apos;,</span><br><span class="line">  // 执行顺序，前置，还有一个选项是post是后置</span><br><span class="line">  // 把 eslint-loader 的执行顺序放到最前面，防止其它 Loader 把处理后的代码交给 eslint-loader 去检查</span><br><span class="line">  enforce: &apos;pre&apos;,</span><br><span class="line">  // 包含文件夹</span><br><span class="line">  include: [resolve(&apos;src&apos;), resolve(&apos;test&apos;)],</span><br><span class="line">  options: &#123;</span><br><span class="line">    // 使用友好的eslint提示插件</span><br><span class="line">    formatter: require(&apos;eslint-friendly-formatter&apos;),</span><br><span class="line">    // eslint报错提示是否显示以遮罩形式显示在浏览器中</span><br><span class="line">    // 这里showEslintErrorsInOverlay配置是false</span><br><span class="line">    emitWarning: !config.dev.showEslintErrorsInOverlay</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">module.exports = &#123;</span><br><span class="line">  // 运行环境的上下文，就是实际的目录，也就是项目根目录</span><br><span class="line">  context: path.resolve(__dirname, &apos;../&apos;),</span><br><span class="line">  // 入口</span><br><span class="line">  entry: &#123;</span><br><span class="line">    app: &apos;./src/main.js&apos;</span><br><span class="line">  &#125;,</span><br><span class="line">  // 输出</span><br><span class="line">  output: &#123;</span><br><span class="line">    // 路径 这里是根目录下的dist</span><br><span class="line">    path: config.build.assetsRoot,</span><br><span class="line">    // 文件名</span><br><span class="line">    filename: &apos;[name].js&apos;,</span><br><span class="line">    publicPath: process.env.NODE_ENV === &apos;production&apos;</span><br><span class="line">      // 这里是 /，但要上传到github pages等会路径不对，需要修改为./</span><br><span class="line">      ? config.build.assetsPublicPath</span><br><span class="line">      // 这里配置是 /</span><br><span class="line">      : config.dev.assetsPublicPath</span><br><span class="line">  &#125;,</span><br><span class="line">  // Webpack 在启动后会从配置的入口模块出发找出所有依赖的模块，Resolve 配置 Webpack 如何寻找模块所对应的文件。</span><br><span class="line">  resolve: &#123;</span><br><span class="line">    // 配置了这个，对应的扩展名可以省略</span><br><span class="line">    extensions: [&apos;.js&apos;, &apos;.vue&apos;, &apos;.json&apos;],</span><br><span class="line">    alias: &#123;</span><br><span class="line">      // 给定对象的键后的末尾添加 $，以表示精准匹配 node_modules/vue/dist/vue.esm.js</span><br><span class="line">      // 引用 import Vue from &apos;vue&apos;就是引入的这个文件最后export default Vue 导出的Vue;</span><br><span class="line">      // 所以这句可以以任意大写字母命名 比如：import V from &apos;vue&apos;</span><br><span class="line">      &apos;vue$&apos;: &apos;vue/dist/vue.esm.js&apos;,</span><br><span class="line">      // src别名 比如 ：引入import HelloWorld from &apos;@/components/HelloWorld&apos;</span><br><span class="line">      &apos;@&apos;: resolve(&apos;src&apos;),</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  // 定义一些文件的转换规则</span><br><span class="line">  module: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      // 是否使用eslint 这里配置是true</span><br><span class="line">      ...(config.dev.useEslint ? [createLintingRule()] : []),</span><br><span class="line">      &#123;</span><br><span class="line">        test: /\.vue$/,</span><br><span class="line">        // vue-loader中文文档：https://vue-loader-v14.vuejs.org/zh-cn/</span><br><span class="line">        loader: &apos;vue-loader&apos;,</span><br><span class="line">        options: vueLoaderConfig</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        // js文件使用babel-loader转换</span><br><span class="line">        test: /\.js$/,</span><br><span class="line">        loader: &apos;babel-loader&apos;,</span><br><span class="line">        include: [resolve(&apos;src&apos;), resolve(&apos;test&apos;), resolve(&apos;node_modules/webpack-dev-server/client&apos;)]</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        // 图片文件使用url-loader转换</span><br><span class="line">        test: /\.(png|jpe?g|gif|svg)(\?.*)?$/,</span><br><span class="line">        loader: &apos;url-loader&apos;,</span><br><span class="line">        options: &#123;</span><br><span class="line">          // 限制大小10000B(bytes)以内，转成base64编码的dataURL字符串</span><br><span class="line">          limit: 10000,</span><br><span class="line">          // 输出路径 img/名称.7位hash.扩展名</span><br><span class="line">          name: utils.assetsPath(&apos;img/[name].[hash:7].[ext]&apos;)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        // 视频文件使用url-loader转换</span><br><span class="line">        test: /\.(mp4|webm|ogg|mp3|wav|flac|aac)(\?.*)?$/,</span><br><span class="line">        loader: &apos;url-loader&apos;,</span><br><span class="line">        options: &#123;</span><br><span class="line">          limit: 10000,</span><br><span class="line">          name: utils.assetsPath(&apos;media/[name].[hash:7].[ext]&apos;)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        test: /\.(woff2?|eot|ttf|otf)(\?.*)?$/,</span><br><span class="line">        loader: &apos;url-loader&apos;,</span><br><span class="line">        options: &#123;</span><br><span class="line">          limit: 10000,</span><br><span class="line">          name: utils.assetsPath(&apos;fonts/[name].[hash:7].[ext]&apos;)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  // 这里的node是一个对象，其中每个属性都是 Node.js 全局变量或模块的名称，每个 value 是以下其中之一</span><br><span class="line">  // empty 提供空对象。</span><br><span class="line">  // false 什么都不提供。</span><br><span class="line">  // 更多查看 中文文档：https://webpack.docschina.org/configuration/node/</span><br><span class="line">  node: &#123;</span><br><span class="line">    // prevent webpack from injecting useless setImmediate polyfill because Vue</span><br><span class="line">    // source contains it (although only uses it if it&apos;s native).</span><br><span class="line">    // 防止webpack注入一些polyfill 因为Vue已经包含了这些。</span><br><span class="line">    setImmediate: false,</span><br><span class="line">    // prevent webpack from injecting mocks to Node native modules</span><br><span class="line">    // that does not make sense for the client</span><br><span class="line">    dgram: &apos;empty&apos;,</span><br><span class="line">    fs: &apos;empty&apos;,</span><br><span class="line">    net: &apos;empty&apos;,</span><br><span class="line">    tls: &apos;empty&apos;,</span><br><span class="line">    child_process: &apos;empty&apos;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="build-vue-loader-conf-js-vue-loader配置文件"><a href="#build-vue-loader-conf-js-vue-loader配置文件" class="headerlink" title="build/vue-loader.conf.js vue-loader配置文件"></a><code>build/vue-loader.conf.js</code> <code>vue-loader</code>配置文件</h3><p>上文<code>build/webpack.dev.conf.js</code>提到引入了<code>build/vue-loader.conf.js</code>。</p>
<p>这个文件主要导出了一份<code>Vue-loader</code>的配置，<br>主要有：<code>loaders</code>，<code>cssSourceMap</code>，<code>cacheBusting</code>，<code>transformToRequire</code>。</p>
<p>具体看该文件注释：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&apos;use strict&apos;</span><br><span class="line">const utils = require(&apos;./utils&apos;)</span><br><span class="line">const config = require(&apos;../config&apos;)</span><br><span class="line">const isProduction = process.env.NODE_ENV === &apos;production&apos;</span><br><span class="line">const sourceMapEnabled = isProduction</span><br><span class="line">  // 这里是true</span><br><span class="line">  ? config.build.productionSourceMap</span><br><span class="line">  // 这里是true</span><br><span class="line">  : config.dev.cssSourceMap</span><br><span class="line">// 更多配置 可以查看vue-loader中文文档：https://vue-loader-v14.vuejs.org/zh-cn/</span><br><span class="line">module.exports = &#123;</span><br><span class="line">  // cssLoaders 生成相应loader配置，具体看utils文件中的cssLoader</span><br><span class="line">  loaders: utils.cssLoaders(&#123;</span><br><span class="line">    // 是否开启sourceMap，便于调试</span><br><span class="line">    sourceMap: sourceMapEnabled,</span><br><span class="line">    // 是否提取vue单文件的css</span><br><span class="line">    extract: isProduction</span><br><span class="line">  &#125;),</span><br><span class="line">  // 是否开启cssSourceMap，便于调试</span><br><span class="line">  cssSourceMap: sourceMapEnabled,</span><br><span class="line">  // 这里是true</span><br><span class="line">  // 缓存破坏，进行sourceMap debug时，设置成false很有帮助。</span><br><span class="line">  cacheBusting: config.dev.cacheBusting,</span><br><span class="line">  // vue单文件中，在模板中的图片等资源引用转成require的形式。以便目标资源可以由 webpack 处理。</span><br><span class="line">  transformToRequire: &#123;</span><br><span class="line">    video: [&apos;src&apos;, &apos;poster&apos;],</span><br><span class="line">    source: &apos;src&apos;,</span><br><span class="line">    img: &apos;src&apos;,</span><br><span class="line">    // 默认配置会转换 &lt;img&gt; 标签上的 src 属性和 SVG 的 &lt;image&gt; 标签上的 xlink：href 属性。</span><br><span class="line">    image: &apos;xlink:href&apos;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>看完了这些文件相应配置，开发环境的相关配置就串起来了。其中<code>config/</code>文件夹下的配置，笔者都已经注释在<code>build/</code>文件夹下的对应的文件中，所以就不单独说明了。</p>
<p>那回过头来看，<code>package.json</code>的<code>scripts</code>中的<code>npm run build</code>配置，<code>node build/build.js</code>，其实就是用<code>node</code>去执行<code>build/build.js</code>文件。</p>
<h3 id="build-build-js-npm-run-build-指定执行的文件"><a href="#build-build-js-npm-run-build-指定执行的文件" class="headerlink" title="build/build.js npm run build 指定执行的文件"></a><code>build/build.js</code> <code>npm run build</code> 指定执行的文件</h3><p>这个文件主要做了以下几件事情：<br>1、引入<code>build/check-versions</code>文件，检查<code>node</code>和<code>npm</code>的版本，<br>2、引入相关插件和配置，其中引入了<code>webpack</code>生产环境的配置<code>build/webpack.prod.conf.js</code>，<br>3、先控制台输出<code>loading</code>，删除<code>dist</code>目录下的文件，开始构建，构建失败和构建成功都给出相应的提示信息。</p>
<p>具体可以查看相应的注释：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">&apos;use strict&apos;</span><br><span class="line">// 检查node npm的版本</span><br><span class="line">require(&apos;./check-versions&apos;)()</span><br><span class="line"></span><br><span class="line">process.env.NODE_ENV = &apos;production&apos;</span><br><span class="line">// 命令行中的loading</span><br><span class="line">const ora = require(&apos;ora&apos;)</span><br><span class="line">// 删除文件或文件夹</span><br><span class="line">const rm = require(&apos;rimraf&apos;)</span><br><span class="line">// 路径相关</span><br><span class="line">const path = require(&apos;path&apos;)</span><br><span class="line">// 控制台输入样式 chalk 更多查看：https://github.com/chalk/chalk</span><br><span class="line">const chalk = require(&apos;chalk&apos;)</span><br><span class="line">// 引入webpack</span><br><span class="line">const webpack = require(&apos;webpack&apos;)</span><br><span class="line">// 引入config/index.js</span><br><span class="line">const config = require(&apos;../config&apos;)</span><br><span class="line">// 引入 生产环境webpack配置</span><br><span class="line">const webpackConfig = require(&apos;./webpack.prod.conf&apos;)</span><br><span class="line"></span><br><span class="line">// 控制台输入开始构建loading</span><br><span class="line">const spinner = ora(&apos;building for production...&apos;)</span><br><span class="line">spinner.start()</span><br><span class="line"></span><br><span class="line">// 删除原有构建输出的目录文件 这里是dist 和 static</span><br><span class="line">rm(path.join(config.build.assetsRoot, config.build.assetsSubDirectory), err =&gt; &#123;</span><br><span class="line">  // 如果出错，抛出错误</span><br><span class="line">  if (err) throw err</span><br><span class="line">  webpack(webpackConfig, (err, stats) =&gt; &#123;</span><br><span class="line">    // 关闭 控制台输入开始构建loading</span><br><span class="line">    spinner.stop()</span><br><span class="line">    // 如果出错，抛出错误</span><br><span class="line">    if (err) throw err</span><br><span class="line">    process.stdout.write(stats.toString(&#123;</span><br><span class="line">      colors: true,</span><br><span class="line">      modules: false,</span><br><span class="line">      children: false, // If you are using ts-loader, setting this to true will make TypeScript errors show up during build.</span><br><span class="line">      chunks: false,</span><br><span class="line">      chunkModules: false</span><br><span class="line">    &#125;) + &apos;\n\n&apos;)</span><br><span class="line"></span><br><span class="line">    // 如果有错，控制台输出构建失败</span><br><span class="line">    if (stats.hasErrors()) &#123;</span><br><span class="line">      console.log(chalk.red(&apos;  Build failed with errors.\n&apos;))</span><br><span class="line">      process.exit(1)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 控制台输出构建成功相关信息</span><br><span class="line">    console.log(chalk.cyan(&apos;  Build complete.\n&apos;))</span><br><span class="line">    console.log(chalk.yellow(</span><br><span class="line">      &apos;  Tip: built files are meant to be served over an HTTP server.\n&apos; +</span><br><span class="line">      &apos;  Opening index.html over file:// won\&apos;t work.\n&apos;</span><br><span class="line">    ))</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="build-check-versions-检查node和npm版本"><a href="#build-check-versions-检查node和npm版本" class="headerlink" title="build/check-versions 检查node和npm版本"></a><code>build/check-versions</code> 检查<code>node</code>和<code>npm</code>版本</h3><p>上文提到<code>build/check-versions</code> 检查<code>node</code>和<code>npm</code>版本，这个文件主要引入了一些插件和配置，最后导出一个函数，版本不符合预期就输出警告。</p>
<p>具体查看这个配置文件注释：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">&apos;use strict&apos;</span><br><span class="line">// 控制台输入样式 chalk 更多查看：https://github.com/chalk/chalk</span><br><span class="line">const chalk = require(&apos;chalk&apos;)</span><br><span class="line">// 语义化控制版本的插件 更多查看：https://github.com/npm/node-semver</span><br><span class="line">const semver = require(&apos;semver&apos;)</span><br><span class="line">// package.json配置</span><br><span class="line">const packageConfig = require(&apos;../package.json&apos;)</span><br><span class="line">// shell 脚本 Unix shell commands for Node.js 更多查看：https://github.com/shelljs/shelljs</span><br><span class="line">const shell = require(&apos;shelljs&apos;)</span><br><span class="line"></span><br><span class="line">function exec (cmd) &#123;</span><br><span class="line">  return require(&apos;child_process&apos;).execSync(cmd).toString().trim()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const versionRequirements = [</span><br><span class="line">  &#123;</span><br><span class="line">    name: &apos;node&apos;,</span><br><span class="line">    currentVersion: semver.clean(process.version),</span><br><span class="line">    // 这里配置是&quot;node&quot;: &quot;&gt;= 6.0.0&quot;,</span><br><span class="line">    versionRequirement: packageConfig.engines.node</span><br><span class="line">  &#125;</span><br><span class="line">]</span><br><span class="line">// 需要使用npm</span><br><span class="line">if (shell.which(&apos;npm&apos;)) &#123;</span><br><span class="line">  versionRequirements.push(&#123;</span><br><span class="line">    name: &apos;npm&apos;,</span><br><span class="line">    currentVersion: exec(&apos;npm --version&apos;),</span><br><span class="line">    // 这里配置是&quot;npm&quot;: &quot;&gt;= 3.0.0&quot;</span><br><span class="line">    versionRequirement: packageConfig.engines.npm</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line">// 导出一个检查版本的函数</span><br><span class="line">module.exports = function () &#123;</span><br><span class="line">  const warnings = []</span><br><span class="line"></span><br><span class="line">  for (let i = 0; i &lt; versionRequirements.length; i++) &#123;</span><br><span class="line">    const mod = versionRequirements[i]</span><br><span class="line"></span><br><span class="line">    // 当前版本不大于所需版本</span><br><span class="line">    if (!semver.satisfies(mod.currentVersion, mod.versionRequirement)) &#123;</span><br><span class="line">      warnings.push(mod.name + &apos;: &apos; +</span><br><span class="line">        chalk.red(mod.currentVersion) + &apos; should be &apos; +</span><br><span class="line">        chalk.green(mod.versionRequirement)</span><br><span class="line">      )</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  // 如果有警告，全部输出到控制台</span><br><span class="line">  if (warnings.length) &#123;</span><br><span class="line">    console.log(&apos;&apos;)</span><br><span class="line">    console.log(chalk.yellow(&apos;To use this template, you must update following to modules:&apos;))</span><br><span class="line">    console.log()</span><br><span class="line"></span><br><span class="line">    for (let i = 0; i &lt; warnings.length; i++) &#123;</span><br><span class="line">      const warning = warnings[i]</span><br><span class="line">      console.log(&apos;  &apos; + warning)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    console.log()</span><br><span class="line">    process.exit(1)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="build-webpack-prod-conf-js-webpack生产环境配置"><a href="#build-webpack-prod-conf-js-webpack生产环境配置" class="headerlink" title="build/webpack.prod.conf.js webpack生产环境配置"></a><code>build/webpack.prod.conf.js</code> <code>webpack</code>生产环境配置</h3><p>上文<code>build/build.js</code>提到，引入了这个配置文件。<br>这个文件主要做了以下几件事情：<br>1、引入一些插件和配置，其中引入了<code>build/webpack.base.conf.js</code> <code>webpack</code>基本配置文件，<br>2、用<code>DefinePlugin</code>定义环境，<br>3、合并基本配置，定义自己的配置<code>webpackConfig</code>，配置了一些<code>modules</code>下的<code>rules</code>，<code>devtools</code>配置，<code>output</code>输出配置，一些处理<code>js</code>、提取<code>css</code>、压缩<code>css</code>、输出<code>html</code>插件、提取公共代码等的<br><code>plugins</code>，<br>4、如果启用<code>gzip</code>，再使用相应的插件处理，<br>5、如果启用了分析打包后的插件，则用<code>webpack-bundle-analyzer</code>，<br>6、最后导出这份配置。</p>
<p>具体可以查看这个文件配置注释：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br></pre></td><td class="code"><pre><span class="line">&apos;use strict&apos;</span><br><span class="line">// 引入node路径相关</span><br><span class="line">const path = require(&apos;path&apos;)</span><br><span class="line">// 引入utils工具函数</span><br><span class="line">const utils = require(&apos;./utils&apos;)</span><br><span class="line">// 引入webpack</span><br><span class="line">const webpack = require(&apos;webpack&apos;)</span><br><span class="line">// 引入config/index.js配置文件</span><br><span class="line">const config = require(&apos;../config&apos;)</span><br><span class="line">// 合并webpack配置的插件</span><br><span class="line">const merge = require(&apos;webpack-merge&apos;)</span><br><span class="line">// 基本的webpack配置</span><br><span class="line">const baseWebpackConfig = require(&apos;./webpack.base.conf&apos;)</span><br><span class="line">// 拷贝文件和文件夹的插件</span><br><span class="line">const CopyWebpackPlugin = require(&apos;copy-webpack-plugin&apos;)</span><br><span class="line">// 压缩处理HTML的插件</span><br><span class="line">const HtmlWebpackPlugin = require(&apos;html-webpack-plugin&apos;)</span><br><span class="line">const ExtractTextPlugin = require(&apos;extract-text-webpack-plugin&apos;)</span><br><span class="line">// 压缩处理css的插件</span><br><span class="line">const OptimizeCSSPlugin = require(&apos;optimize-css-assets-webpack-plugin&apos;)</span><br><span class="line">// 压缩处理js的插件</span><br><span class="line">const UglifyJsPlugin = require(&apos;uglifyjs-webpack-plugin&apos;)</span><br><span class="line"></span><br><span class="line">// 用DefinePlugin定义环境</span><br><span class="line">const env = process.env.NODE_ENV === &apos;testing&apos;</span><br><span class="line">  // 这里是 &#123; NODE_ENV: &apos;&quot;testing&quot;&apos; &#125;</span><br><span class="line">  ? require(&apos;../config/test.env&apos;)</span><br><span class="line">  // 这里是 &#123; NODE_ENV: &apos;&quot;production&quot;&apos; &#125;</span><br><span class="line">  : require(&apos;../config/prod.env&apos;)</span><br><span class="line">// 合并基本webpack配置</span><br><span class="line">const webpackConfig = merge(baseWebpackConfig, &#123;</span><br><span class="line">  module: &#123;</span><br><span class="line">    // 通过styleLoaders函数生成样式的一些规则</span><br><span class="line">    rules: utils.styleLoaders(&#123;</span><br><span class="line">      // sourceMap这里是true</span><br><span class="line">      sourceMap: config.build.productionSourceMap,</span><br><span class="line">      // 是否提取css到单独的css文件</span><br><span class="line">      extract: true,</span><br><span class="line">      // 是否使用postcss</span><br><span class="line">      usePostCSS: true</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  // 配置使用sourceMap true 这里是 #source-map</span><br><span class="line">  devtool: config.build.productionSourceMap ? config.build.devtool : false,</span><br><span class="line">  output: &#123;</span><br><span class="line">    // 这里是根目录下的dist</span><br><span class="line">    path: config.build.assetsRoot,</span><br><span class="line">    // 文件名称 chunkhash</span><br><span class="line">    filename: utils.assetsPath(&apos;js/[name].[chunkhash].js&apos;),</span><br><span class="line">    // chunks名称 chunkhash</span><br><span class="line">    chunkFilename: utils.assetsPath(&apos;js/[id].[chunkhash].js&apos;)</span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [</span><br><span class="line">    // http://vuejs.github.io/vue-loader/en/workflow/production.html</span><br><span class="line">    // 定义具体是什么环境</span><br><span class="line">    new webpack.DefinePlugin(&#123;</span><br><span class="line">      &apos;process.env&apos;: env</span><br><span class="line">    &#125;),</span><br><span class="line">    // 压缩js插件</span><br><span class="line">    new UglifyJsPlugin(&#123;</span><br><span class="line">      uglifyOptions: &#123;</span><br><span class="line">        compress: &#123;</span><br><span class="line">          // 警告</span><br><span class="line">          warnings: false</span><br><span class="line">          // 构建后的文件 常用的配置还有这些</span><br><span class="line">          // 去除console.log 默认为false。  传入true会丢弃对console函数的调用。</span><br><span class="line">          // drop_console: true,</span><br><span class="line">          // 去除debugger</span><br><span class="line">          // drop_debugger: true,</span><br><span class="line">          // 默认为null. 你可以传入一个名称的数组，而UglifyJs将会假定那些函数不会产生副作用。</span><br><span class="line">          // pure_funcs: [ &apos;console.log&apos;, &apos;console.log.apply&apos; ],</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      // 是否开启sourceMap 这里是true</span><br><span class="line">      sourceMap: config.build.productionSourceMap,</span><br><span class="line">      // 平行处理（同时处理）加快速度</span><br><span class="line">      parallel: true</span><br><span class="line">    &#125;),</span><br><span class="line">    // extract css into its own file</span><br><span class="line">    // 提取css到单独的css文件</span><br><span class="line">    new ExtractTextPlugin(&#123;</span><br><span class="line">      // 提取到相应的文件名 使用内容hash contenthash</span><br><span class="line">      filename: utils.assetsPath(&apos;css/[name].[contenthash].css&apos;),</span><br><span class="line">      // Setting the following option to `false` will not extract CSS from codesplit chunks.</span><br><span class="line">      // Their CSS will instead be inserted dynamically with style-loader when the codesplit chunk has been loaded by webpack.</span><br><span class="line">      // It&apos;s currently set to `true` because we are seeing that sourcemaps are included in the codesplit bundle as well when it&apos;s `false`,</span><br><span class="line">      // increasing file size: https://github.com/vuejs-templates/webpack/issues/1110</span><br><span class="line">      // allChunks 默认是false,true指提取所有chunks包括动态引入的组件。</span><br><span class="line">      allChunks: true,</span><br><span class="line">    &#125;),</span><br><span class="line">    // Compress extracted CSS. We are using this plugin so that possible</span><br><span class="line">    // duplicated CSS from different components can be deduped.</span><br><span class="line">    new OptimizeCSSPlugin(&#123;</span><br><span class="line">      // 这里配置是true</span><br><span class="line">      cssProcessorOptions: config.build.productionSourceMap</span><br><span class="line">        ? &#123; safe: true, map: &#123; inline: false &#125; &#125;</span><br><span class="line">        : &#123; safe: true &#125;</span><br><span class="line">    &#125;),</span><br><span class="line">    // generate dist index.html with correct asset hash for caching.</span><br><span class="line">    // you can customize output by editing /index.html</span><br><span class="line">    // see https://github.com/ampedandwired/html-webpack-plugin</span><br><span class="line">    new HtmlWebpackPlugin(&#123;</span><br><span class="line">      // 输出html名称</span><br><span class="line">      filename: process.env.NODE_ENV === &apos;testing&apos;</span><br><span class="line">        ? &apos;index.html&apos;</span><br><span class="line">        // 这里是 根目录下的dist/index.html</span><br><span class="line">        : config.build.index,</span><br><span class="line">      // 使用哪个模板</span><br><span class="line">      template: &apos;index.html&apos;,</span><br><span class="line">      // inject 默认值 true，script标签位于html文件的 body 底部</span><br><span class="line">      // body 通true, header, script 标签位于 head 标签内</span><br><span class="line">      // false 不插入生成的 js 文件，只是单纯的生成一个 html 文件</span><br><span class="line">      inject: true,</span><br><span class="line">      // 压缩</span><br><span class="line">      minify: &#123;</span><br><span class="line">        // 删除注释</span><br><span class="line">        removeComments: true,</span><br><span class="line">        // 删除空格和换行</span><br><span class="line">        collapseWhitespace: true,</span><br><span class="line">        // 删除html标签中属性的双引号</span><br><span class="line">        removeAttributeQuotes: true</span><br><span class="line">        // 更多配置查看html-minifier插件</span><br><span class="line">        // more options:</span><br><span class="line">        // https://github.com/kangax/html-minifier#options-quick-reference</span><br><span class="line">      &#125;,</span><br><span class="line">      // necessary to consistently work with multiple chunks via CommonsChunkPlugin</span><br><span class="line">      // 在chunk被插入到html之前，你可以控制它们的排序。允许的值 ‘none’ | ‘auto’ | ‘dependency’ | &#123;function&#125; 默认为‘auto’.</span><br><span class="line">      // dependency 依赖（从属）</span><br><span class="line">      chunksSortMode: &apos;dependency&apos;</span><br><span class="line">    &#125;),</span><br><span class="line">    // keep module.id stable when vendor modules does not change</span><br><span class="line">    // 根据代码内容生成普通模块的id，确保源码不变，moduleID不变。</span><br><span class="line">    new webpack.HashedModuleIdsPlugin(),</span><br><span class="line">    // enable scope hoisting</span><br><span class="line">    // 开启作用域提升 webpack3新的特性，作用是让代码文件更小、运行的更快</span><br><span class="line">    new webpack.optimize.ModuleConcatenationPlugin(),</span><br><span class="line">    // split vendor js into its own file</span><br><span class="line">    // 提取公共代码</span><br><span class="line">    new webpack.optimize.CommonsChunkPlugin(&#123;</span><br><span class="line">      name: &apos;vendor&apos;,</span><br><span class="line">      minChunks (module) &#123;</span><br><span class="line">        // any required modules inside node_modules are extracted to vendor</span><br><span class="line">        return (</span><br><span class="line">          module.resource &amp;&amp;</span><br><span class="line">          /\.js$/.test(module.resource) &amp;&amp;</span><br><span class="line">          module.resource.indexOf(</span><br><span class="line">            path.join(__dirname, &apos;../node_modules&apos;)</span><br><span class="line">          ) === 0</span><br><span class="line">        )</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;),</span><br><span class="line">    // extract webpack runtime and module manifest to its own file in order to</span><br><span class="line">    // prevent vendor hash from being updated whenever app bundle is updated</span><br><span class="line">    // 提取公共代码</span><br><span class="line">    new webpack.optimize.CommonsChunkPlugin(&#123;</span><br><span class="line">      // 把公共的部分放到 manifest 中</span><br><span class="line">      name: &apos;manifest&apos;,</span><br><span class="line">      // 传入 `Infinity` 会马上生成 公共chunk，但里面没有模块。</span><br><span class="line">      minChunks: Infinity</span><br><span class="line">    &#125;),</span><br><span class="line">    // This instance extracts shared chunks from code splitted chunks and bundles them</span><br><span class="line">    // in a separate chunk, similar to the vendor chunk</span><br><span class="line">    // see: https://webpack.js.org/plugins/commons-chunk-plugin/#extra-async-commons-chunk</span><br><span class="line">    // 提取动态组件</span><br><span class="line">    new webpack.optimize.CommonsChunkPlugin(&#123;</span><br><span class="line">      name: &apos;app&apos;,</span><br><span class="line">      // 如果设置为 `true`，一个异步的  公共chunk 会作为 `options.name` 的子模块，和 `options.chunks` 的兄弟模块被创建。</span><br><span class="line">      // 它会与 `options.chunks` 并行被加载。可以通过提供想要的字符串，而不是 `true` 来对输出的文件进行更换名称。</span><br><span class="line">      async: &apos;vendor-async&apos;,</span><br><span class="line">      // 如果设置为 `true`，所有  公共chunk 的子模块都会被选择</span><br><span class="line">      children: true,</span><br><span class="line">      // 最小3个，包含3，chunk的时候提取</span><br><span class="line">      minChunks: 3</span><br><span class="line">    &#125;),</span><br><span class="line"></span><br><span class="line">    // copy custom static assets</span><br><span class="line">    // 把static资源复制到相应目录。</span><br><span class="line">    new CopyWebpackPlugin([</span><br><span class="line">      &#123;</span><br><span class="line">        from: path.resolve(__dirname, &apos;../static&apos;),</span><br><span class="line">        // 这里配置是static</span><br><span class="line">        to: config.build.assetsSubDirectory,</span><br><span class="line">        // 忽略.开头的文件。比如这里的.gitkeep，这个文件是指空文件夹也提交到git</span><br><span class="line">        ignore: [&apos;.*&apos;]</span><br><span class="line">      &#125;</span><br><span class="line">    ])</span><br><span class="line">  ]</span><br><span class="line">&#125;)</span><br><span class="line">// 如果开始gzip压缩，使用compression-webpack-plugin插件处理。这里配置是false</span><br><span class="line">// 需要使用是需要安装 npm i compression-webpack-plugin -D</span><br><span class="line">if (config.build.productionGzip) &#123;</span><br><span class="line">  const CompressionWebpackPlugin = require(&apos;compression-webpack-plugin&apos;)</span><br><span class="line"></span><br><span class="line">  webpackConfig.plugins.push(</span><br><span class="line">    new CompressionWebpackPlugin(&#123;</span><br><span class="line">      // asset： 目标资源名称。 [file] 会被替换成原始资源。</span><br><span class="line">      // [path] 会被替换成原始资源的路径， [query] 会被替换成查询字符串。默认值是 &quot;[path].gz[query]&quot;。</span><br><span class="line">      asset: &apos;[path].gz[query]&apos;,</span><br><span class="line">      // algorithm： 可以是 function(buf, callback) 或者字符串。对于字符串来说依照 zlib 的算法(或者 zopfli 的算法)。默认值是 &quot;gzip&quot;。</span><br><span class="line">      algorithm: &apos;gzip&apos;,</span><br><span class="line">      // test： 所有匹配该正则的资源都会被处理。默认值是全部资源。</span><br><span class="line">      // config.build.productionGzipExtensions 这里是[&apos;js&apos;, &apos;css&apos;]</span><br><span class="line">      test: new RegExp(</span><br><span class="line">        &apos;\\.(&apos; +</span><br><span class="line">        config.build.productionGzipExtensions.join(&apos;|&apos;) +</span><br><span class="line">        &apos;)$&apos;</span><br><span class="line">      ),</span><br><span class="line">      // threshold： 只有大小大于该值的资源会被处理。单位是 bytes。默认值是 0。</span><br><span class="line">      threshold: 10240,</span><br><span class="line">      // minRatio： 只有压缩率小于这个值的资源才会被处理。默认值是 0.8。</span><br><span class="line">      minRatio: 0.8</span><br><span class="line">    &#125;)</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 输出分析的插件 运行npm run build --report</span><br><span class="line">// config.build.bundleAnalyzerReport这里是 process.env.npm_config_report</span><br><span class="line">// build结束后会自定打开 http://127.0.0.1:8888 链接</span><br><span class="line">if (config.build.bundleAnalyzerReport) &#123;</span><br><span class="line">  // 更多查看链接地址：https://www.npmjs.com/package/webpack-bundle-analyzer</span><br><span class="line">  const BundleAnalyzerPlugin = require(&apos;webpack-bundle-analyzer&apos;).BundleAnalyzerPlugin</span><br><span class="line">  webpackConfig.plugins.push(new BundleAnalyzerPlugin())</span><br><span class="line">&#125;</span><br><span class="line">// 当然也可以用官方提供的网站 http://webpack.github.io/analyse/#home</span><br><span class="line">// 运行类似 webpack --profile --json &gt; stats.json 命令</span><br><span class="line">// 把生成的构建信息stats.json上传即可</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// 最终导出 webpackConfig</span><br><span class="line">module.exports = webpackConfig</span><br></pre></td></tr></table></figure>
<p>至此，我们就分析完了<code>package.json</code>中的<code>npm run dev</code>和<code>npm run build</code>两个命令。测试相关的类似就略过吧。</p>
<p><code>npm run lint</code>，<code>.eslintrc.js</code>中的配置不多，更多可以查看<a href="https://eslint.org/" target="_blank" rel="noopener">eslint英文文档</a>或<a href="http://eslint.cn/" target="_blank" rel="noopener"><code>eslint</code>中文官网</a>，所以也略过吧。不过提一下，把<code>eslint</code>整合到<code>git</code>工作流。可以安装<code>husky</code>，<code>npm i husky -S</code>。安装后，配置<code>package.json</code>的<code>scripts</code>中，配置<code>precommit</code>，具体如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&quot;scripts&quot;: &#123;</span><br><span class="line">  &quot;lint&quot;: &quot;eslint --ext .js,.vue src test/unit test/e2e/specs&quot;,</span><br><span class="line">  &quot;precommit&quot;: &quot;npm run lint&quot;,</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></p>
<p>配置好后，每次<code>git commit -m</code>提交会检查代码是否通过<code>eslint</code>校验，如果没有校验通过则提交失败。还可以配置<code>prepush</code>。<code>husky</code>不断在更新，现在可能与原先的配置不太相同了，具体查看<a href="https://github.com/typicode/husky" target="_blank" rel="noopener">husky github仓库</a>。原理就是<code>git-hooks</code>,<code>pre-commit</code>的钩子。对<code>shell</code>脚本熟悉的同学也可以自己写一份<code>pre-commit</code>。复制到项目的<code>.git/hooks/pre-commit</code>中。不需要依赖<code>husky</code>包。我司就是用的<code>shell</code>脚本。</p>
<p>最后提一下<code>.babelrc</code>文件中的配置。</p>
<h3 id="babelrc-babel相关配置"><a href="#babelrc-babel相关配置" class="headerlink" title=".babelrc babel相关配置"></a><code>.babelrc</code> <code>babel</code>相关配置</h3><p>配置了一些转码规则。这里附上两个链接：<a href="https://babeljs.io/" target="_blank" rel="noopener"><code>babel</code>英文官网</a>和<a href="https://babel.bootcss.com/" target="_blank" rel="noopener"><code>babel</code>的中文官网</a>。</p>
<p>具体看文件中的配置注释：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  // presets指明转码的规则</span><br><span class="line">  &quot;presets&quot;: [</span><br><span class="line">    // env项是借助插件babel-preset-env，下面这个配置说的是babel对es6,es7,es8进行转码，并且设置amd,commonjs这样的模块化文件，不进行转码</span><br><span class="line">    [&quot;env&quot;, &#123;</span><br><span class="line">      &quot;modules&quot;: false,</span><br><span class="line">      &quot;targets&quot;: &#123;</span><br><span class="line">        &quot;browsers&quot;: [&quot;&gt; 1%&quot;, &quot;last 2 versions&quot;, &quot;not ie &lt;= 8&quot;]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;],</span><br><span class="line">    &quot;stage-2&quot;</span><br><span class="line">  ],</span><br><span class="line">  // plugins 属性告诉 Babel 要使用哪些插件，插件可以控制如何转换代码。</span><br><span class="line">  // transform-vue-jsx 表明可以在项目中使用jsx语法，会使用这个插件转换</span><br><span class="line">  &quot;plugins&quot;: [&quot;transform-vue-jsx&quot;, &quot;transform-runtime&quot;],</span><br><span class="line">  // 在特定的环境中所执行的转码规则，当环境变量是下面的test就会覆盖上面的设置</span><br><span class="line">  &quot;env&quot;: &#123;</span><br><span class="line">    // test 是提前设置的环境变量，如果没有设置BABEL_ENV则使用NODE_ENV，如果都没有设置默认就是development</span><br><span class="line">    &quot;test&quot;: &#123;</span><br><span class="line">      &quot;presets&quot;: [&quot;env&quot;, &quot;stage-2&quot;],</span><br><span class="line">      &quot;plugins&quot;: [&quot;transform-vue-jsx&quot;, &quot;transform-es2015-modules-commonjs&quot;, &quot;dynamic-import-node&quot;]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>文件中<code>presets</code>中有配置<code>env</code>和<code>stage-2</code>，可能不知道是什么。这里引用<a href="http://webpack.wuhaolin.cn/3%E5%AE%9E%E6%88%98/3-1%E4%BD%BF%E7%94%A8ES6%E8%AF%AD%E8%A8%80.html" target="_blank" rel="noopener">深入浅出webpack</a>书中，第三章，<code>3-1</code>使用<code>ES6</code>语言 小节的一段，解释一下。</p>
<blockquote>
<p><code>presets</code> 属性告诉 <code>Babel</code> 要转换的源码使用了哪些新的语法特性，一个 Presets 对一组新语法特性提供支持，多个 <code>Presets</code> 可以叠加。 <code>Presets</code> 其实是一组 <code>Plugins</code> 的集合，每一个 <code>Plugin</code> 完成一个新语法的转换工作。<code>Presets</code> 是按照 <code>ECMAScript</code> 草案来组织的，通常可以分为以下三大类（书中就是说三大类，我发现就两点~~~）：<br>1、已经被写入 ECMAScript 标准里的特性，由于之前每年都有新特性被加入到标准里，所以又可细分为：<br>es2015 包含在2015里加入的新特性；<br>es2016 包含在2016里加入的新特性；<br>es2017 包含在2017里加入的新特性；<br>es2017 包含在2017里加入的新特性；<br>env 包含当前所有 ECMAScript 标准里的最新特性。<br>2、被社区提出来的但还未被写入 <code>ECMAScript</code> 标准里特性，这其中又分为以下四种：<br><code>stage0</code> 只是一个美好激进的想法，有 <code>Babel</code> 插件实现了对这些特性的支持，但是不确定是否会被定为标准；<br><code>stage1</code> 值得被纳入标准的特性；<br><code>stage2</code> 该特性规范已经被起草，将会被纳入标准里；<br><code>stage3</code> 该特性规范已经定稿，各大浏览器厂商和 <code></code> 社区开始着手实现；<br><code>stage4</code> 在接下来的一年将会加入到标准里去。</p>
</blockquote>
<p>至此，就算相对完整的分析完了<code>Vue-cli</code>(版本<code>v2.9.3</code>)搭建的<code>webpack</code>项目工程。希望对大家有所帮助。<br><strong>项目放在笔者的<code>github</code>上，<a href="https://github.com/lxchuan12/analyse-vue-cli" target="_blank" rel="noopener">分析vue-cli@2.9.3 搭建的webpack项目工程</a>。方便大家克隆下载，或者在线查看。同时也求个<code>star</code> <code>^_^</code>，也是对笔者的一种鼓励和支持。</strong><br>笔者知识能力有限，文章有什么不妥之处，欢迎指出~</p>
<h3 id="关于"><a href="#关于" class="headerlink" title="关于"></a>关于</h3><p>作者：常以<strong>轩辕Rowboat</strong>为名混迹于江湖。前端路上 | PPT爱好者 | 所知甚少，唯善学。<br><a href="https://lxchuan12.github.io/">个人博客</a><br><a href="https://segmentfault.com/u/lxchuan12" target="_blank" rel="noopener">segmentfault个人主页</a><br><a href="https://juejin.im/user/57974dc55bbb500063f522fd/posts" target="_blank" rel="noopener">掘金个人主页</a><br><a href="https://www.zhihu.com/people/lxchuan12/activities" target="_blank" rel="noopener">知乎</a><br><a href="https://github.com/lxchuan12" target="_blank" rel="noopener">github</a></p>
<h3 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h3><p>1、分析这些，逐行注释，还是需要一些时间的。其中有些不是很明白的地方，及时查阅相应的官方文档和插件文档（建议看英文文档和最新的文档），不过文档没写明白的地方，可以多搜索一些别人的博客文章，相对比较清晰明了。<br>2、前端发展太快，这个<a href="mailto:`Vue-cli@2.9.3" target="_blank" rel="noopener">`Vue-cli@2.9.3</a><code></code>webpack<code>版本还是</code>v3.x<code>，webpack现在官方版本已经是</code>v4.12.0<code>，相信不久后，</code>Vue-cli<code>也将发布支持</code>webpack v4.x<code>的版本，</code>v3.0.0<code>已经是</code>beta.16<code>了。
3、后续有余力，可能会继续分析新版的</code>vue-cli<code>构建的</code>webpack`项目工程。</p>

        </div>

        <blockquote class="post-copyright">
    
    <div class="content">
        
<span class="post-time">
    最后更新时间：<time datetime="2018-06-12T14:29:33.460Z" itemprop="dateUpdated">2018-06-12 22:29:33</time>
</span><br>


        
        这里可以写作者留言，标签和 hexo 中所有变量及辅助函数等均可调用，示例：<a href="/2018/06/11/20180611-analyse-vue-cli/" target="_blank" rel="external">https://lxchuan12.github.io/2018/06/11/20180611-analyse-vue-cli/</a>
        
    </div>
    
    <footer>
        <a href="https://lxchuan12.github.io">
            <img src="/img/logo.jpg" alt="轩辕Rowboat">
            轩辕Rowboat
        </a>
    </footer>
</blockquote>

        
<div class="page-reward">
    <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-circle waves-light">赏</a>
</div>



        <div class="post-footer">
            
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/vue/">vue</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/vue-cli/">vue-cli</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/webpack/">webpack</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://lxchuan12.github.io/2018/06/11/20180611-analyse-vue-cli/&title=《分析vue-cli@2.9.3 搭建的webpack项目工程》 — 轩辕Rowboat的博客&pic=https://lxchuan12.github.io/img/logo.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://lxchuan12.github.io/2018/06/11/20180611-analyse-vue-cli/&title=《分析vue-cli@2.9.3 搭建的webpack项目工程》 — 轩辕Rowboat的博客&source=轩辕Rowboat，某世界闻名的陶瓷大学2016届毕业生，目前在杭州从事前端开发工作，也是一枚PPT爱好者。所知甚少，唯善学。常以轩辕Rowboat为名混..." data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://lxchuan12.github.io/2018/06/11/20180611-analyse-vue-cli/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《分析vue-cli@2.9.3 搭建的webpack项目工程》 — 轩辕Rowboat的博客&url=https://lxchuan12.github.io/2018/06/11/20180611-analyse-vue-cli/&via=https://lxchuan12.github.io" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://lxchuan12.github.io/2018/06/11/20180611-analyse-vue-cli/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>
    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/2018/07/14/20180714-some baiduyunpan-and chrome crx/" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">分享百度网盘下载搜索神器和一些实用浏览器插件</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/2018/06/03/20180603-oh my zsh - window git bash alias/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">oh my zsh 和 window git bash 设置别名提高效率</h4>
      </a>
    </div>
  
</nav>



    











    <!-- Valine Comments -->
    <div class="comments vcomment" id="comments"></div>
    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
    <script src="//unpkg.com/valine@latest/dist/Valine.min.js"></script>
    <!-- Valine Comments script -->
    <script>
        var GUEST_INFO = ['nick','mail','link'];
        var guest_info = 'nick,mail,link'.split(',').filter(function(item){
          return GUEST_INFO.indexOf(item) > -1
        });
        new Valine({
            el: '#comments',
            notify: 'true' == 'true',
            verify: 'false' == 'true',
            appId: "0TKTK966CPwc1sozltNJnPwi-gzGzoHsz",
            appKey: "pqWw70koe6UNqnGfrPBLgPCO",
            avatar: "mm",
            placeholder: "ヾﾉ≧∀≦)o来啊，快活啊!",
            guest_info: guest_info.length == 0 ? GUEST_INFO : guest_info,
            pageSize: "10"
        })
    </script>
    <!-- Valine Comments end -->







</article>

<div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        你的打赏是我写作的动力~
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardCode" src="/img/wechat.jpg" alt="打赏二维码">
        </div>
        
        <label class="reward-toggle">
            <input id="rewardToggle" type="checkbox" class="reward-toggle-check"
                data-wechat="/img/wechat.jpg" data-alipay="/img/alipay.jpg">
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">微信</span>
                <span class="reward-toggle-label"></span>
                <span class="reward-toggle-item alipay">支付宝</span>
            </div>
        </label>
        
    </div>
</div>



</div>

        <footer class="footer">
    <div class="top">
        
<p>
    <span id="busuanzi_container_site_uv" style='display:none'>
        站点总访客数：<span id="busuanzi_value_site_uv"></span>
    </span>
    <span id="busuanzi_container_site_pv" style='display:none'>
        站点总访问量：<span id="busuanzi_value_site_pv"></span>
    </span>
</p>


        <p>
            
                <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span>博客内容遵循 <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">知识共享 署名 - 非商业性 - 相同方式共享 4.0 国际协议</a></span>
        </p>
        <p>
            <span>轩辕Rowboat &copy; 2016 - 2018</span>
            <span>
                
                Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a>
            </span>
        </p>
    </div>
    <div class="bottom" style="display: none">
        <p><span>轩辕Rowboat &copy; 2016 - 2018</span>
            <span>
                
                Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://lxchuan12.github.io/2018/06/11/20180611-analyse-vue-cli/&title=《分析vue-cli@2.9.3 搭建的webpack项目工程》 — 轩辕Rowboat的博客&pic=https://lxchuan12.github.io/img/logo.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://lxchuan12.github.io/2018/06/11/20180611-analyse-vue-cli/&title=《分析vue-cli@2.9.3 搭建的webpack项目工程》 — 轩辕Rowboat的博客&source=轩辕Rowboat，某世界闻名的陶瓷大学2016届毕业生，目前在杭州从事前端开发工作，也是一枚PPT爱好者。所知甚少，唯善学。常以轩辕Rowboat为名混..." data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://lxchuan12.github.io/2018/06/11/20180611-analyse-vue-cli/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《分析vue-cli@2.9.3 搭建的webpack项目工程》 — 轩辕Rowboat的博客&url=https://lxchuan12.github.io/2018/06/11/20180611-analyse-vue-cli/&via=https://lxchuan12.github.io" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://lxchuan12.github.io/2018/06/11/20180611-analyse-vue-cli/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="//api.qrserver.com/v1/create-qr-code/?data=https://lxchuan12.github.io/2018/06/11/20180611-analyse-vue-cli/" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: true };


lazyScripts.push('//s95.cnzz.com/z_stat.php?id=1273798602&web_id=1273798602');
// lazyScripts.push('//cdnjs.cloudflare.com/ajax/libs/platform/1.3.5/platform.min.js');

</script>

<script src="/js/main.min.js?v=1.7.2"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="/js/search.min.js?v=1.7.2" async></script>






<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>



<script>
(function() {
    var OriginTitile = document.title, titleTime;
    document.addEventListener('visibilitychange', function() {
        if (document.hidden) {
            document.title = '(つェ⊂)Good Bye！';
            clearTimeout(titleTime);
        } else {
            document.title = 'Hi~Welcome back!';
            titleTime = setTimeout(function() {
                document.title = OriginTitile;
            },2000);
        }
    });
})();
</script>



</body>
</html>
